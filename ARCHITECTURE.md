# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë° ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

## ëª©ì°¨
1. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
2. [í•µì‹¬ ì•Œê³ ë¦¬ì¦˜](#í•µì‹¬-ì•Œê³ ë¦¬ì¦˜)
3. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
4. [ì£¼ì˜ì‚¬í•­ ë° í•´ê²° ë°©ë²•](#ì£¼ì˜ì‚¬í•­-ë°-í•´ê²°-ë°©ë²•)
5. [ìµœì í™” ì „ëµ](#ìµœì í™”-ì „ëµ)

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì ì•±                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  UI ë ˆì´ì–´ â”‚  â”‚ ìƒíƒœ ê´€ë¦¬  â”‚  â”‚ ì•Œë¦¼ ì‹œìŠ¤í…œ â”‚         â”‚
â”‚  â”‚ (React)  â”‚  â”‚(Zustand) â”‚  â”‚(Push Notif)â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚        ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë ˆì´ì–´            â”‚           â”‚
â”‚  â”‚  - ê²½ë¡œ ê³„ì‚° ì—”ì§„                     â”‚           â”‚
â”‚  â”‚  - íƒ€ì´ë° ë¶„ì„ ì—”ì§„                   â”‚           â”‚
â”‚  â”‚  - ì•Œë¦¼ ê²°ì • ì—”ì§„                     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ GPS ì¶”ì   â”‚  â”‚Geofencingâ”‚  â”‚ API í´ë¼ì´ì–¸íŠ¸â”‚       â”‚
â”‚  â”‚  ì„œë¹„ìŠ¤   â”‚  â”‚  ì„œë¹„ìŠ¤   â”‚  â”‚   ë ˆì´ì–´    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ì™¸ë¶€ ì„œë¹„ìŠ¤                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ ì„œìš¸ì‹œ ë²„ìŠ¤ API                                    â”‚
â”‚  â€¢ ì„œìš¸ì‹œ ì§€í•˜ì²  API                                  â”‚
â”‚  â€¢ ì„œìš¸ì‹œ ì‹ í˜¸ë“± API (788ê°œì†Œ)                        â”‚
â”‚  â€¢ ì¹´ì¹´ì˜¤ë§µ/ë„¤ì´ë²„ ì§€ë„ API                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´í¬ë„ŒíŠ¸ ì„¸ë¶€ ì„¤ëª…

#### 1. GPS ì¶”ì  ì„œë¹„ìŠ¤
**ì—­í• **: ì‚¬ìš©ìì˜ ì‹¤ì‹œê°„ ìœ„ì¹˜ë¥¼ ì¶”ì í•˜ê³  ì´ë™ ìƒíƒœë¥¼ ê°ì§€

**í•µì‹¬ ê¸°ëŠ¥**:
```javascript
// GPS ì¶”ì  ëª¨ë“œ
const GPSMode = {
  STOPPED: 0,      // ì •ì§€ ìƒíƒœ (í´ë§ ê°„ê²©: 60ì´ˆ)
  WALKING: 1,      // ë„ë³´ ì´ë™ (í´ë§ ê°„ê²©: 5ì´ˆ)
  RUNNING: 2,      // ë¹ ë¥¸ ì´ë™ (í´ë§ ê°„ê²©: 2ì´ˆ)
  IN_TRANSIT: 3,   // ëŒ€ì¤‘êµí†µ íƒ‘ìŠ¹ ì¤‘ (í´ë§ ê°„ê²©: 10ì´ˆ)
};
```

**ë™ì‘ ì›ë¦¬**:
1. ì†ë„ ê¸°ë°˜ ëª¨ë“œ ì „í™˜
   - 0-1 km/h â†’ STOPPED
   - 1-5 km/h â†’ WALKING
   - 5-10 km/h â†’ RUNNING
   - 10+ km/h â†’ IN_TRANSIT

2. ë°°í„°ë¦¬ ìµœì í™”
   - ì •ì§€ ì¤‘: GPS ìµœì†Œí™”, ìœ ì˜ë¯¸í•œ ìœ„ì¹˜ ë³€í™”ë§Œ ê°ì§€
   - ì´ë™ ì¤‘: ê³ ë¹ˆë„ ì¶”ì ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ

#### 2. Geofencing ì„œë¹„ìŠ¤
**ì—­í• **: ë²„ìŠ¤ ì •ë¥˜ì¥/ì§€í•˜ì² ì—­ ì§„ì…/ì´íƒˆ ìë™ ê°ì§€

**Geofence ì„¤ì •**:
```javascript
const createGeofence = (location) => ({
  identifier: location.id,
  latitude: location.lat,
  longitude: location.lng,
  radius: 100, // ë¯¸í„° (ë²„ìŠ¤ ì •ë¥˜ì¥)
  // ì§€í•˜ì² ì—­ì€ 150m (ì¶œì…êµ¬ ì—¬ëŸ¬ ê°œ)
  notifyOnEntry: true,
  notifyOnExit: true,
});
```

**ì§„ì… ê°ì§€ ì‹œë‚˜ë¦¬ì˜¤**:
```
ì‚¬ìš©ì ìœ„ì¹˜ â†’ ì •ë¥˜ì¥ 150m
              â†“
         [Geofence ëŒ€ê¸° ìƒíƒœ]
              â†“
ì‚¬ìš©ì ìœ„ì¹˜ â†’ ì •ë¥˜ì¥ 100m (ì§„ì…!)
              â†“
         [ì•Œë¦¼ íŠ¸ë¦¬ê±°]
         "ë²„ìŠ¤ ì •ë¥˜ì¥ ë„ì°©!"
              â†“
    [ì‹¤ì‹œê°„ ë²„ìŠ¤ ë„ì°© ì •ë³´ ì¡°íšŒ]
```

---

## í•µì‹¬ ì•Œê³ ë¦¬ì¦˜

### 1. í–‰ë™ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (Core Decision Engine)

ì´ ì•Œê³ ë¦¬ì¦˜ì´ ì•±ì˜ í•µì‹¬ì´ë‹¤. "ë›°ì–´ì•¼ í•˜ëŠ”ê°€, ì²œì²œíˆ ê°€ë„ ë˜ëŠ”ê°€"ë¥¼ ê²°ì •í•œë‹¤.

#### ì…ë ¥ ë³€ìˆ˜
```javascript
const inputs = {
  userLocation: { lat, lng },           // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜
  targetLocation: { lat, lng },         // ëª©í‘œ ì§€ì  (ë²„ìŠ¤ ì •ë¥˜ì¥/ì§€í•˜ì² ì—­)
  busArrivalTime: 180,                  // ë²„ìŠ¤ ë„ì°©ê¹Œì§€ ì‹œê°„ (ì´ˆ)
  walkingSpeed: 1.2,                    // ì‚¬ìš©ì í‰ê·  ë³´í–‰ ì†ë„ (m/s)
  distanceToTarget: 300,                // ëª©í‘œê¹Œì§€ ê±°ë¦¬ (m)
  trafficSignals: [                     // ê²½ë¡œ ìƒ ì‹ í˜¸ë“± ì •ë³´
    { id: 'signal_1', timeToRed: 30, cycleTime: 90 }
  ]
};
```

#### ì•Œê³ ë¦¬ì¦˜ ë‹¨ê³„

**Step 1: ìˆœìˆ˜ ì´ë™ ì‹œê°„ ê³„ì‚°**
```javascript
// ê±°ë¦¬ Ã· ì†ë„ = ì‹œê°„
const pureWalkTime = distanceToTarget / walkingSpeed;
// 300m Ã· 1.2m/s = 250ì´ˆ (ì•½ 4ë¶„ 10ì´ˆ)
```

**Step 2: ì‹ í˜¸ë“± ëŒ€ê¸° ì‹œê°„ ì¶”ê°€**
```javascript
let totalWaitTime = 0;

for (const signal of trafficSignals) {
  if (signal.api_available) {
    // ì„œìš¸: ì‹¤ì‹œê°„ API ì‚¬ìš©
    totalWaitTime += signal.currentRedTime;
  } else {
    // ì„œìš¸ ì™¸: ë³´ìˆ˜ì  ì¶”ì •
    // ìµœì•…ì˜ ê²½ìš° = ì „ì²´ ì‚¬ì´í´ ëŒ€ê¸°
    totalWaitTime += signal.estimatedCycleTime * 0.7; // 70% ê°€ì •
  }
}

// ì˜ˆ: ì‹ í˜¸ë“± 2ê°œ, ê° 60ì´ˆ ëŒ€ê¸° â†’ 120ì´ˆ
```

**Step 3: ì•ˆì „ ë§ˆì§„ ì¶”ê°€**
```javascript
const SAFETY_MARGIN = 30; // 30ì´ˆ ì—¬ìœ 
const totalRequiredTime = pureWalkTime + totalWaitTime + SAFETY_MARGIN;
// 250 + 120 + 30 = 400ì´ˆ (6ë¶„ 40ì´ˆ)
```

**Step 4: ê²°ì • ë¡œì§**
```javascript
function decideAction(busArrivalTime, totalRequiredTime) {
  const timeDiff = busArrivalTime - totalRequiredTime;
  
  if (timeDiff < 0) {
    // ë²„ìŠ¤ ë†“ì¹¨
    return {
      action: 'MISSED',
      message: 'ğŸ˜¢ ì´ë²ˆ ë²„ìŠ¤ëŠ” ë†“ì³¤ì–´ìš”',
      color: 'red',
      vibrate: false,
    };
  } else if (timeDiff < 30) {
    // ë›°ì–´ì•¼ í•¨
    return {
      action: 'RUN',
      message: 'ğŸƒ ì§€ê¸ˆ ë¹ ë¥´ê²Œ ì´ë™í•˜ì„¸ìš”!',
      urgency: 'HIGH',
      color: 'red',
      vibrate: true,
      voiceAlert: true, // ìŒì„± ì•Œë¦¼
    };
  } else if (timeDiff < 60) {
    // ë¹ ë¥´ê²Œ ê±·ê¸°
    return {
      action: 'WALK_FAST',
      message: 'ğŸš¶ ì¡°ê¸ˆ ì„œë‘ë¥´ì„¸ìš”',
      urgency: 'MEDIUM',
      color: 'orange',
      vibrate: true,
    };
  } else {
    // ì—¬ìœ ìˆìŒ
    return {
      action: 'WALK_NORMAL',
      message: 'âœ… ì—¬ìœ ìˆê²Œ ê°€ì„¸ìš”',
      urgency: 'LOW',
      color: 'green',
      vibrate: false,
    };
  }
}
```

#### ì‹¤ì œ ì˜ˆì‹œ

**ì‹œë‚˜ë¦¬ì˜¤ A: ë›°ì–´ì•¼ í•˜ëŠ” ê²½ìš°**
```
ì‚¬ìš©ì ìœ„ì¹˜: ì •ë¥˜ì¥ì—ì„œ 400m
ë²„ìŠ¤ ë„ì°©: 4ë¶„ í›„ (240ì´ˆ)
ë³´í–‰ ì†ë„: 1.2m/s
ì‹ í˜¸ë“±: 2ê°œ (ê° í‰ê·  50ì´ˆ ëŒ€ê¸°)

ê³„ì‚°:
- ìˆœìˆ˜ ì´ë™ ì‹œê°„: 400 Ã· 1.2 = 333ì´ˆ
- ì‹ í˜¸ ëŒ€ê¸°: 100ì´ˆ
- ì•ˆì „ ë§ˆì§„: 30ì´ˆ
- ì´ í•„ìš” ì‹œê°„: 463ì´ˆ

íŒì •: 463 > 240 â†’ "ì§€ê¸ˆ ë›°ì–´ì•¼ í•´ìš”!" ğŸƒ
```

**ì‹œë‚˜ë¦¬ì˜¤ B: ì—¬ìœ ìˆëŠ” ê²½ìš°**
```
ì‚¬ìš©ì ìœ„ì¹˜: ì •ë¥˜ì¥ì—ì„œ 200m
ë²„ìŠ¤ ë„ì°©: 10ë¶„ í›„ (600ì´ˆ)
ë³´í–‰ ì†ë„: 1.2m/s
ì‹ í˜¸ë“±: 1ê°œ (í‰ê·  40ì´ˆ ëŒ€ê¸°)

ê³„ì‚°:
- ìˆœìˆ˜ ì´ë™ ì‹œê°„: 200 Ã· 1.2 = 167ì´ˆ
- ì‹ í˜¸ ëŒ€ê¸°: 40ì´ˆ
- ì•ˆì „ ë§ˆì§„: 30ì´ˆ
- ì´ í•„ìš” ì‹œê°„: 237ì´ˆ

íŒì •: 600 - 237 = 363ì´ˆ ì—¬ìœ  â†’ "ì—¬ìœ ìˆê²Œ ê°€ì„¸ìš”" âœ…
```

---

### 2. í™˜ìŠ¹ íƒ€ì´ë° ì•Œê³ ë¦¬ì¦˜

í™˜ìŠ¹ì—­ì—ì„œ "ì§€ê¸ˆ ë›¸ì§€, ë‹¤ìŒ ì—´ì°¨ë¥¼ íƒˆì§€" ê²°ì •

#### ì…ë ¥ ë³€ìˆ˜
```javascript
const transferInputs = {
  currentLine: '2í˜¸ì„ ',
  targetLine: '3í˜¸ì„ ',
  platformDistance: 180,        // í”Œë«í¼ ê°„ ê±°ë¦¬ (m)
  stairCount: 2,                // ê³„ë‹¨/ì—ìŠ¤ì»¬ë ˆì´í„° ê°œìˆ˜
  crowdLevel: 'MEDIUM',         // í˜¼ì¡ë„
  nextTrainArrival: 180,        // ë‹¤ìŒ ì—´ì°¨ ë„ì°© (ì´ˆ)
  userWalkSpeed: 1.2,           // ì‚¬ìš©ì ì†ë„ (m/s)
};
```

#### í™˜ìŠ¹ ì‹œê°„ ê³„ì‚°
```javascript
function calculateTransferTime(inputs) {
  // ê¸°ë³¸ ì´ë™ ì‹œê°„
  let baseTime = inputs.platformDistance / inputs.userWalkSpeed;
  
  // ê³„ë‹¨/ì—ìŠ¤ì»¬ë ˆì´í„° ë³´ì •
  const stairPenalty = inputs.stairCount * 15; // ê° 15ì´ˆ ì¶”ê°€
  
  // í˜¼ì¡ë„ ë³´ì •
  const crowdMultiplier = {
    'LOW': 1.0,
    'MEDIUM': 1.2,
    'HIGH': 1.5,
  }[inputs.crowdLevel];
  
  // ì•ˆì „ ë§ˆì§„
  const safetyMargin = 20;
  
  const totalTime = (baseTime + stairPenalty) * crowdMultiplier + safetyMargin;
  
  return Math.ceil(totalTime);
}

// ì˜ˆ: 180m, ê³„ë‹¨ 2ê°œ, ì¤‘ê°„ í˜¼ì¡
// (180/1.2 + 30) * 1.2 + 20 = 254ì´ˆ (ì•½ 4ë¶„ 15ì´ˆ)
```

#### ê²°ì • ë¡œì§
```javascript
function decideTransferAction(transferTime, nextTrainArrival) {
  if (nextTrainArrival < transferTime) {
    return {
      action: 'WAIT_NEXT_TRAIN',
      message: 'â³ ë‹¤ìŒ ì—´ì°¨ë¥¼ íƒ€ì„¸ìš”\n(í˜„ì¬ ì—´ì°¨ëŠ” ë†“ì¹  í™•ë¥  ë†’ìŒ)',
      nextTrain: nextTrainArrival + 300, // ë‹¤ìŒ ì—´ì°¨ ì‹œê°„
    };
  } else if (nextTrainArrival - transferTime < 30) {
    return {
      action: 'RUN',
      message: 'ğŸƒ ë¹ ë¥´ê²Œ í™˜ìŠ¹í•˜ì„¸ìš”!\nì—´ì°¨ê°€ ê³§ ì¶œë°œí•©ë‹ˆë‹¤',
      urgency: 'HIGH',
    };
  } else {
    return {
      action: 'WALK',
      message: 'âœ… ì—¬ìœ ìˆê²Œ í™˜ìŠ¹í•˜ì„¸ìš”\në„ì°©ê¹Œì§€ ' + (nextTrainArrival - transferTime) + 'ì´ˆ ë‚¨ìŒ',
      urgency: 'LOW',
    };
  }
}
```

---

### 3. ì‹ í˜¸ë“± ì˜ˆì¸¡ ì•Œê³ ë¦¬ì¦˜

#### ì„œìš¸ (ì‹¤ì‹œê°„ API ìˆìŒ)
```javascript
async function getSignalTiming(signalId) {
  const response = await fetch(
    `https://t-data.seoul.go.kr/apig/apiman-gateway/tapi/v2xSignalPhaseTimingInformation/1.0`,
    {
      params: { signalId }
    }
  );
  
  const data = response.data;
  
  return {
    currentPhase: data.current_phase, // 'RED' | 'GREEN'
    timeRemaining: data.time_remaining, // ì´ˆ
    cycleTime: data.cycle_time, // ì „ì²´ ì‚¬ì´í´ (ì´ˆ)
    confidence: 1.0, // 100% ì •í™•
  };
}
```

#### ì„œìš¸ ì™¸ (í¬ë¼ìš°ë“œì†Œì‹± í•™ìŠµ)
```javascript
class SignalLearner {
  constructor() {
    this.patterns = {}; // { signalId: { samples: [], avgCycle: 0 } }
  }
  
  // ì‚¬ìš©ìê°€ ì‹ í˜¸ë¥¼ í†µê³¼í•  ë•Œë§ˆë‹¤ ê¸°ë¡
  recordCrossing(signalId, waitTime) {
    if (!this.patterns[signalId]) {
      this.patterns[signalId] = { samples: [], avgCycle: 0 };
    }
    
    this.patterns[signalId].samples.push({
      waitTime,
      timestamp: Date.now(),
    });
    
    // í‰ê·  ê³„ì‚° (ìµœê·¼ 100ê°œ ìƒ˜í”Œ)
    const recent = this.patterns[signalId].samples.slice(-100);
    this.patterns[signalId].avgCycle = 
      recent.reduce((sum, s) => sum + s.waitTime, 0) / recent.length;
  }
  
  // ì˜ˆì¸¡
  predictWaitTime(signalId) {
    const pattern = this.patterns[signalId];
    
    if (!pattern || pattern.samples.length < 10) {
      // ë°ì´í„° ë¶€ì¡±: ë³´ìˆ˜ì  ì¶”ì •
      return {
        waitTime: 60, // ê¸°ë³¸ 60ì´ˆ ê°€ì •
        confidence: 0.3, // ì‹ ë¢°ë„ 30%
      };
    }
    
    return {
      waitTime: pattern.avgCycle * 0.5, // í‰ê· ì˜ 50% (í†µê³„ì  ê¸°ëŒ“ê°’)
      confidence: Math.min(pattern.samples.length / 100, 0.8), // ìµœëŒ€ 80%
    };
  }
}
```

---

## ë°ì´í„° íë¦„

### ì „ì²´ í”Œë¡œìš°

```
[ì‚¬ìš©ìê°€ ê²½ë¡œ ì…ë ¥]
        â†“
[ê²½ë¡œ ê³„ì‚° + ì‹ í˜¸ë“±/ë²„ìŠ¤ì •ë¥˜ì¥ ì¶”ì¶œ]
        â†“
[GPS ì¶”ì  ì‹œì‘]
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ â”‚ â† 2-60ì´ˆë§ˆë‹¤
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
[ê±°ë¦¬ ê³„ì‚° + ë²„ìŠ¤ ë„ì°© ì‹œê°„ ì¡°íšŒ]
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   [ê²°ì • ë„ì¶œ]
        â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
  â”‚  ì•Œë¦¼ í•„ìš”?  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     YES â”‚  NO
        â†“    â””â”€â†’ [ëŒ€ê¸°]
  [ì•Œë¦¼ ì „ì†¡]
        â†“
  [ì‚¬ìš©ì í™•ì¸]
```

### ìƒíƒœ ê´€ë¦¬ (Zustand)

```javascript
// store.js
import create from 'zustand';

const useStore = create((set, get) => ({
  // ì‚¬ìš©ì ìƒíƒœ
  userLocation: null,
  route: null,
  isTracking: false,
  
  // ëŒ€ì¤‘êµí†µ ì •ë³´
  busArrivals: {},
  subwayArrivals: {},
  
  // ì•Œë¦¼ ìƒíƒœ
  lastNotification: null,
  notificationHistory: [],
  
  // Actions
  setUserLocation: (location) => set({ userLocation: location }),
  
  startTracking: () => {
    set({ isTracking: true });
    // GPS ì¶”ì  ì‹œì‘
    BackgroundGeolocation.start();
  },
  
  stopTracking: () => {
    set({ isTracking: false });
    BackgroundGeolocation.stop();
  },
  
  updateBusArrivals: async (stopId) => {
    const arrivals = await fetchBusArrivals(stopId);
    set((state) => ({
      busArrivals: {
        ...state.busArrivals,
        [stopId]: arrivals,
      },
    }));
  },
  
  sendNotification: (notification) => {
    const { lastNotification, notificationHistory } = get();
    
    // ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€ (30ì´ˆ ì´ë‚´ ê°™ì€ ë‚´ìš©)
    if (
      lastNotification &&
      Date.now() - lastNotification.timestamp < 30000 &&
      lastNotification.message === notification.message
    ) {
      return; // ì „ì†¡ ì•ˆí•¨
    }
    
    // ì•Œë¦¼ ì „ì†¡
    LocalNotification.send(notification);
    
    // ê¸°ë¡
    set({
      lastNotification: {
        ...notification,
        timestamp: Date.now(),
      },
      notificationHistory: [
        ...notificationHistory,
        notification,
      ].slice(-50), // ìµœê·¼ 50ê°œë§Œ ë³´ê´€
    });
  },
}));
```

---

## ì£¼ì˜ì‚¬í•­ ë° í•´ê²° ë°©ë²•

### 1. ë°°í„°ë¦¬ ì†Œëª¨ ë¬¸ì œ

**ë¬¸ì œ**: GPS ì§€ì† ì¶”ì  = ë°°í„°ë¦¬ ê¸‰ì† ì†Œëª¨

**í•´ê²°ì±…**:

#### A. ì ì‘í˜• í´ë§ ê°„ê²©
```javascript
function adjustGPSInterval(userState) {
  const { speed, isNearTarget, batteryLevel } = userState;
  
  // ë°°í„°ë¦¬ 20% ì´í•˜: ì ˆì•½ ëª¨ë“œ
  if (batteryLevel < 20) {
    return 30000; // 30ì´ˆ ê°„ê²©
  }
  
  // ëª©í‘œ ê·¼ì²˜ (500m ì´ë‚´): ê³ ë¹ˆë„
  if (isNearTarget) {
    return 2000; // 2ì´ˆ ê°„ê²©
  }
  
  // ì´ë™ ì¤‘: ì¤‘ê°„ ë¹ˆë„
  if (speed > 1) {
    return 5000; // 5ì´ˆ ê°„ê²©
  }
  
  // ì •ì§€ ì¤‘: ì €ë¹ˆë„
  return 60000; // 60ì´ˆ ê°„ê²©
}
```

#### B. Significant Location Change
```javascript
// iOS: ìœ ì˜ë¯¸í•œ ìœ„ì¹˜ ë³€í™”ë§Œ ê°ì§€ (ì—ë„ˆì§€ íš¨ìœ¨ì )
BackgroundGeolocation.configure({
  desiredAccuracy: BackgroundGeolocation.HIGH_ACCURACY,
  stationaryRadius: 50,
  distanceFilter: 50, // 50m ì´ë™ ì‹œì—ë§Œ ì—…ë°ì´íŠ¸
  pauseLocationUpdatesAutomatically: true,
});
```

### 2. ìœ„ì¹˜ ì •í™•ë„ ë¬¸ì œ

**ë¬¸ì œ**: ì§€í•˜ì² ì—­/ê±´ë¬¼ ë‚´ë¶€ì—ì„œ GPS ë¶€ì •í™•

**í•´ê²°ì±…**:

#### A. WiFi/Beacon ë³´ì¡°
```javascript
// ì£¼ìš” ì§€í•˜ì² ì—­ì— Beacon ì„¤ì¹˜ (í–¥í›„ ê³„íš)
async function detectStationByBeacon() {
  const beacons = await BluetoothManager.scan();
  
  for (const beacon of beacons) {
    if (beacon.uuid.startsWith('SUBWAY_')) {
      return {
        type: 'SUBWAY_STATION',
        stationId: beacon.major,
        platformId: beacon.minor,
        accuracy: 'HIGH',
      };
    }
  }
  
  return null;
}
```

#### B. ë§ˆì§€ë§‰ ì•Œë ¤ì§„ ìœ„ì¹˜ ì‚¬ìš©
```javascript
let lastKnownGoodLocation = null;

function updateLocation(newLocation) {
  // ì •í™•ë„ ì²´í¬
  if (newLocation.accuracy < 50) {
    // 50m ì´ë‚´ ì •í™•ë„: ì‹ ë¢° ê°€ëŠ¥
    lastKnownGoodLocation = newLocation;
    return newLocation;
  } else {
    // ë¶€ì •í™•: ë§ˆì§€ë§‰ ì¢‹ì€ ìœ„ì¹˜ ì‚¬ìš©
    console.warn('Low accuracy, using last known good location');
    return lastKnownGoodLocation;
  }
}
```

### 3. API í˜¸ì¶œ ë¹„ìš©/ì œí•œ

**ë¬¸ì œ**: ì‹¤ì‹œê°„ APIë¥¼ ë§¤ë²ˆ í˜¸ì¶œí•˜ë©´ ë¹„ìš©/ì œí•œ ì´ˆê³¼

**í•´ê²°ì±…**:

#### A. ë¡œì»¬ ìºì‹±
```javascript
class BusArrivalCache {
  constructor() {
    this.cache = new Map();
    this.TTL = 30000; // 30ì´ˆ ìœ íš¨
  }
  
  async get(stopId) {
    const cached = this.cache.get(stopId);
    
    if (cached && Date.now() - cached.timestamp < this.TTL) {
      return cached.data; // ìºì‹œ ì‚¬ìš©
    }
    
    // API í˜¸ì¶œ
    const fresh = await fetchBusArrivals(stopId);
    this.cache.set(stopId, {
      data: fresh,
      timestamp: Date.now(),
    });
    
    return fresh;
  }
}
```

#### B. ë°°ì¹˜ ìš”ì²­
```javascript
// í•œ ë²ˆì— ì—¬ëŸ¬ ì •ë¥˜ì¥ ì¡°íšŒ (ê°€ëŠ¥í•œ ê²½ìš°)
async function fetchMultipleBusStops(stopIds) {
  const promises = stopIds.map(id => 
    fetch(`/api/bus/arrival?stopId=${id}`)
  );
  
  return Promise.all(promises);
}
```

### 4. ì•Œë¦¼ ìŠ¤íŒ¸ ë°©ì§€

**ë¬¸ì œ**: ë„ˆë¬´ ì¦ì€ ì•Œë¦¼ = ì‚¬ìš©ì í”¼ë¡œ

**í•´ê²°ì±…**:

#### A. ì•Œë¦¼ ì¿¨ë‹¤ìš´
```javascript
const NOTIFICATION_COOLDOWN = {
  'RUN': 60000,        // 1ë¶„ (ê¸´ê¸‰)
  'WALK_FAST': 120000, // 2ë¶„
  'WALK_NORMAL': 300000, // 5ë¶„
};

function shouldSendNotification(type, lastSent) {
  if (!lastSent) return true;
  
  const elapsed = Date.now() - lastSent;
  return elapsed >= NOTIFICATION_COOLDOWN[type];
}
```

#### B. ìƒíƒœ ë³€ê²½ ì‹œì—ë§Œ ì•Œë¦¼
```javascript
let lastDecision = null;

function notifyIfChanged(newDecision) {
  if (!lastDecision || lastDecision.action !== newDecision.action) {
    sendNotification(newDecision);
    lastDecision = newDecision;
  }
}

// ì˜ˆ: "ì—¬ìœ ìˆìŒ" â†’ "ì—¬ìœ ìˆìŒ" = ì•Œë¦¼ ì•ˆë³´ëƒ„
//     "ì—¬ìœ ìˆìŒ" â†’ "ë›°ì–´ë¼" = ì•Œë¦¼ ë³´ëƒ„
```

---

## ìµœì í™” ì „ëµ

### 1. ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
```javascript
// ì§€ë„ ê´€ë ¨ ì½”ë“œëŠ” lazy load
const MapView = React.lazy(() => import('./components/MapView'));

// API í´ë¼ì´ì–¸íŠ¸ë„ í•„ìš”í•  ë•Œë§Œ ë¡œë“œ
const BusAPI = await import('./services/BusAPI');
```

### 2. ì´ë¯¸ì§€ ìµœì í™”
```javascript
// react-native-fast-image ì‚¬ìš©
import FastImage from 'react-native-fast-image';

<FastImage
  source={{ uri: busIcon, priority: FastImage.priority.high }}
  resizeMode={FastImage.resizeMode.contain}
/>
```

### 3. ë©”ëª¨ë¦¬ ê´€ë¦¬
```javascript
// ì‚¬ìš© ì•ˆí•˜ëŠ” ì§€ë„ íƒ€ì¼ ì •ë¦¬
useEffect(() => {
  return () => {
    mapRef.current?.clearTileCache();
  };
}, []);

// ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ì œí•œ
const MAX_HISTORY = 50;
if (notificationHistory.length > MAX_HISTORY) {
  notificationHistory = notificationHistory.slice(-MAX_HISTORY);
}
```

---

## ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ëª©í‘œ

| ì§€í‘œ | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|----------|
| ì•± ì‹œì‘ ì‹œê°„ | < 2ì´ˆ | Time to Interactive |
| ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ì§€ì—° | < 500ms | GPS ì½œë°± â†’ UI ì—…ë°ì´íŠ¸ |
| API ì‘ë‹µ ì‹œê°„ | < 1ì´ˆ | fetch â†’ ë°ì´í„° íŒŒì‹± |
| ë°°í„°ë¦¬ ì†Œëª¨ | < 5%/ì‹œê°„ | 1ì‹œê°„ ì¶”ì  í…ŒìŠ¤íŠ¸ |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | < 100MB | iOS Instruments |
| ì•Œë¦¼ ì •í™•ë„ | > 85% | ì‹¤ì œ ë²„ìŠ¤ ë„ì°© vs ì˜ˆì¸¡ |

---

**ë‹¤ìŒ**: [ê°œë°œ ë¡œë“œë§µ](ROADMAP.md)ì—ì„œ ì£¼ì°¨ë³„ êµ¬í˜„ ê³„íš í™•ì¸
